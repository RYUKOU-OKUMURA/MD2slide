# 技術スタック（ドラフト）
## 1. フロントエンド
- Framework: Next.js / React（SPAでも可）
- Editor: CodeMirror 6（軽量、Markdown拡張が容易、モバイル対応）
- Preview: @marp-team/marp-core（HTML生成）+ iframe表示
- State/Storage: LocalStorage/IndexedDB（下書き・設定保存）
- Auth: Google OAuth 2.0 (PKCE)（クライアント主導が基本）
- 画像処理（段階的対応）:
  - MVP: URL指定のみ、Worker側でhttps URLから取得
  - 拡張: フロントからオブジェクトストレージ（R2/S3）への直接アップロード→URL発行

## 2. バックエンド（エクスポート）
- Runtime: Node.js（もしくはPythonでも可だが、CLI運用を考えるとNodeが相性良い）
- Export engine: marp-cli（PPTX生成: `--pptx`、PDF生成: `--pdf`）
- Queue（MVPはシンプルに、段階的に拡張）:
  - 共通インターフェース: enqueue(job), getStatus(jobId), onComplete(callback)
  - フェーズ1: Cloud Tasks（Redisインフラ不要、GCP管理のキュー）
  - フェーズ2: 負荷増加時に Redis + BullMQ で差し替え
  - ※ Redis管理コスト（ElastiCache/Upstash等）はフェーズ1では不要
- Worker: コンテナ実行（Chromium同梱）
- Storage: 一時ファイル（ローカル/オブジェクトストレージ）＋ジョブDB（PostgreSQL等）

## 3. Google連携
- Google Drive API（アップロード、フォルダ指定）
- Google Picker API（フォルダ選択UI）
- （将来）Google Slides API（変換後の軽い整形やテンプレ適用）

## 4. インフラ
- Hosting: Vercel（フロント） + Cloud Run / Fly.io / ECS（ワーカー）
- Container: Docker（marp-cli + Chromium + fonts）
  - 推奨メモリ: 2GB以上（Chromiumのレンダリング用）
  - タイムアウト: 最大5分（Drive変換完了まで含む）
  - Cold start 対策: min-instances=1 設定を検討（コスト vs UX のトレードオフ）
- Observability: ログ（Cloud Logging等）+ ジョブ監視（失敗率/時間）

## 5. フォント/表示
- Noto Sans JP（推奨）
- 16:9固定
- テーマ: ミニマル（白/薄グレー背景、濃いスレート文字、アクセント控えめ）

## 6. MVPでのAPIスコープ（最小権限の方針）

**採用スコープ（PoC検証済み前提）:**
- `https://www.googleapis.com/auth/drive.file`
  - アプリが作成したファイルへのアクセスのみ（最小権限）
  - Google Pickerで選択したフォルダへのアップロードが本スコープで可能かPoC検証必須

**NG例（採用しない理由）:**
- `https://www.googleapis.com/auth/drive` : Drive全体アクセス → Googleの厳格な審査が発生、リリース遅延リスク

**OAuth審査リスク:**
- `drive.file` 以上のスコープを要求する場合、Googleのセキュリティ審査が必要（数週間〜数ヶ月かかる可能性）
- MVPリリース計画に審査期間を織り込むこと

- 可能ならアプリ専用フォルダ運用も選択肢（ユーザーが任意フォルダを選べる要件と両立できる設計にする）